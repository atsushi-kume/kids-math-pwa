<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>„Åë„ÅÑ„Åï„Çì„Éâ„É™„É´</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f2f6ff;
  margin: 0;
  padding: 16px;
  padding-bottom: calc(16px + env(safe-area-inset-bottom));
  text-align: center;
}

h1 {
  font-size: 32px;
  margin: 10px 0;
}

.question {
  font-size: 42px;
  margin: 20px 0;
  position: relative;
}

.answer {
  font-size: 40px;
  width: 200px;
  padding: 14px;
  text-align: center;
  border-radius: 16px;
  border: 3px solid #bbb;
}

button {
  width: 100%;
  max-width: 360px;
  font-size: 28px;
  padding: 20px;
  margin: 12px auto;
  border-radius: 20px;
  border: none;
  color: white;
}

.btn-generate { background: #4caf50; }
.btn-check { background: #2196f3; }

.result {
  font-size: 40px;
  font-weight: bold;
  min-height: 60px;
  margin-top: 14px;
}

.result.correctText {
  color: #ff9800;
  text-shadow: 0 0 8px #ffd54f;
}

.result.wrongText {
  color: #f44336;
  text-shadow: 0 0 6px #ffcdd2;
}

.settings {
  background: white;
  border-radius: 20px;
  padding: 14px;
  margin-top: 24px;
}

.settings h3 {
  margin-top: 0;
  font-size: 24px;
}

.settings label {
  font-size: 22px;
  display: block;
  margin: 8px 0;
}

/* ===== Ê≠£Ëß£„Éª‰∏çÊ≠£Ëß£„Ç¢„Éã„É° ===== */
@keyframes correctBounce {
  0% { transform: scale(1); }
  30% { transform: scale(1.3); }
  60% { transform: scale(0.95); }
  100% { transform: scale(1); }
}
.correct {
  animation: correctBounce 0.4s ease;
  background: #e6ffe9;
  border-radius: 16px;
}

@keyframes shake {
  0% { transform: translateX(0); }
  20% { transform: translateX(-10px); }
  40% { transform: translateX(10px); }
  60% { transform: translateX(-8px); }
  80% { transform: translateX(8px); }
  100% { transform: translateX(0); }
}
.wrong {
  animation: shake 0.4s;
  background: #ffe6e6;
  border-radius: 16px;
}

/* ===== Êòü„Ç¢„Éã„É° ===== */
.star {
  position: absolute;
  font-size: 28px;
  color: gold;
  animation: flyStar 0.8s ease-out forwards;
  pointer-events: none;
}

@keyframes flyStar {
  0% { transform: translate(0,0) scale(0.5); opacity: 1; }
  100% { transform: translate(var(--dx), var(--dy)) scale(1.4); opacity: 0; }
}
</style>
</head>

<body>

<h1>„Åë„ÅÑ„Åï„Çì„Éâ„É™„É´</h1>

<div id="questionBox" class="question">
  <span id="left">0</span>
  <span id="op">Ôºã</span>
  <span id="right">0</span> =
</div>

<input
  id="answer"
  class="answer"
  type="text"
  inputmode="numeric"
  pattern="[0-9]*"
  placeholder="„Åì„Åü„Åà"
/>

<button class="btn-generate" onclick="generateProblem()">„ÇÇ„Çì„Å†„ÅÑ„Çí„Å§„Åè„Çã</button>
<button class="btn-check" onclick="checkAnswer()">„Åì„Åü„Åà„ÅÇ„Çè„Åõ</button>

<div id="result" class="result"></div>

<div class="settings">
  <h3>„Åõ„Å£„Å¶„ÅÑ</h3>

  <label>
    „Åë„Åü„Åô„ÅÜÔºö
    <input id="digits" type="number" min="1" max="3" value="1">
  </label>

  <label><input type="checkbox" class="opCheck" value="Ôºã" checked> „Åü„Åó„Åñ„Çì</label>
  <label><input type="checkbox" class="opCheck" value="Ôºç" checked> „Å≤„Åç„Åñ„Çì</label>
  <label><input type="checkbox" class="opCheck" value="√ó"> „Åã„Åë„Åñ„Çì</label>
  <label><input type="checkbox" class="opCheck" value="√∑"> „Çè„Çä„Åñ„Çì</label>
</div>

<script>
let correctAnswer = 0;

/* ===== ÂäπÊûúÈü≥ ===== */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playSound(freq) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.frequency.value = freq;
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.4);
  osc.stop(audioCtx.currentTime + 0.4);
}
const playCorrect = () => playSound(880);
const playWrong = () => playSound(220);

/* ===== Êòü ===== */
function spawnStars() {
  const box = document.getElementById("questionBox");
  for (let i = 0; i < 7; i++) {
    const star = document.createElement("div");
    star.className = "star";
    star.textContent = "‚òÖ";
    star.style.setProperty("--dx", (Math.random()*240-120)+"px");
    star.style.setProperty("--dy", (-Math.random()*140-40)+"px");
    box.appendChild(star);
    setTimeout(() => star.remove(), 800);
  }
}

/* ===== ÂïèÈ°åÁîüÊàê ===== */
function generateProblem() {
  const digits = Number(document.getElementById("digits").value) || 1;
  const max = Math.pow(10, digits) - 1;

  const ops = [...document.querySelectorAll(".opCheck:checked")].map(el => el.value);
  if (!ops.length) return alert("„Åà„Çì„Åñ„Çì„Çí„Åà„Çâ„Çì„Åß„Å≠");

  let left, right, op, result;
  op = ops[Math.floor(Math.random()*ops.length)];

  if (op === "√∑") {
    right = Math.floor(Math.random()*max)+1;
    result = Math.floor(Math.random()*max)+1;
    left = right * result;
  } else {
    left = Math.floor(Math.random()*max)+1;
    right = Math.floor(Math.random()*max)+1;
    if (op === "Ôºç" && left < right) [left, right] = [right, left];
    if (op === "Ôºã") result = left + right;
    if (op === "Ôºç") result = left - right;
    if (op === "√ó") result = left * right;
  }

  leftEl.textContent = left;
  rightEl.textContent = right;
  opEl.textContent = op;
  answer.value = "";
  resultEl.textContent = "";
  resultEl.className = "result";
  correctAnswer = result;
}

const leftEl = document.getElementById("left");
const rightEl = document.getElementById("right");
const opEl = document.getElementById("op");
const answer = document.getElementById("answer");
const resultEl = document.getElementById("result");
const box = document.getElementById("questionBox");

/* ===== Á≠î„ÅàÂêà„Çè„Åõ ===== */
function checkAnswer() {
  const user = Number(answer.value);
  box.classList.remove("correct","wrong");
  void box.offsetWidth;

  if (user === correctAnswer) {
    resultEl.textContent = "üéâ „Åõ„ÅÑ„Åã„ÅÑÔºÅ";
    resultEl.className = "result correctText";
    box.classList.add("correct");
    playCorrect();
    spawnStars();
  } else {
    resultEl.textContent = "üí¶ „Å°„Åå„ÅÜ„Çà";
    resultEl.className = "result wrongText";
    box.classList.add("wrong");
    playWrong();
  }
}
</script>

</body>
</html>
